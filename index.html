<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dompet Digital - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-font-smoothing: antialiased; 
            -moz-osx-font-smoothing: grayscale;
            position: relative;
            overflow: hidden;
        }
        .glass-card { 
            background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(12px); 
            -webkit-backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        .smooth-transition { transition: all 0.3s ease-in-out; }

        /* === CSS Animasi Kotak Mengambang === */
        .bg-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .bg-bubbles li {
            position: absolute;
            list-style: none;
            display: block;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.1);
            bottom: -160px;
            animation: square 25s infinite;
            transition-timing-function: linear;
            border-radius: 5px;
        }

        .bg-bubbles li:nth-child(1) { left: 10%; }
        .bg-bubbles li:nth-child(2) { left: 20%; width: 80px; height: 80px; animation-delay: 2s; animation-duration: 17s; }
        .bg-bubbles li:nth-child(3) { left: 25%; animation-delay: 4s; }
        .bg-bubbles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-duration: 22s; background-color: rgba(255, 255, 255, 0.2); }
        .bg-bubbles li:nth-child(5) { left: 70%; }
        .bg-bubbles li:nth-child(6) { left: 80%; width: 120px; height: 120px; animation-delay: 3s; background-color: rgba(255, 255, 255, 0.15); }
        .bg-bubbles li:nth-child(7) { left: 32%; width: 160px; height: 160px; animation-delay: 7s; }
        .bg-bubbles li:nth-child(8) { left: 55%; width: 20px; height: 20px; animation-delay: 15s; animation-duration: 40s; }
        .bg-bubbles li:nth-child(9) { left: 25%; width: 10px; height: 10px; animation-delay: 2s; animation-duration: 40s; background-color: rgba(255, 255, 255, 0.25); }
        .bg-bubbles li:nth-child(10) { left: 90%; width: 160px; height: 160px; animation-delay: 11s; }

        @keyframes square {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(-1080px) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-indigo-900 to-purple-900 text-gray-200">
    
    <!-- Latar Belakang Animasi -->
    <ul class="bg-bubbles">
        <li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li>
    </ul>

    <!-- ===== LAYAR AUTENTIKASI (LOGIN & REGISTER) ===== -->
    <div class="min-h-screen w-full flex flex-col items-center justify-center p-4 relative z-10">
        <div class="w-full max-w-md">
            <!-- Form Login -->
            <div id="login-view">
                <div class="glass-card p-8 rounded-2xl shadow-2xl">
                    <h2 class="text-3xl font-bold text-center text-cyan-300 mb-6">Sign In</h2>
                    <form id="login-form" class="space-y-6">
                        <div>
                            <label for="login-phone" class="text-sm font-medium text-indigo-200">No. Telepon</label>
                            <input type="tel" id="login-phone" required class="w-full p-3 mt-1 bg-gray-800/50 border-2 border-indigo-700 rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none placeholder-gray-500" placeholder="08123456789">
                        </div>
                        <div>
                            <label for="login-password" class="text-sm font-medium text-indigo-200">Password</label>
                            <input type="password" id="login-password" required class="w-full p-3 mt-1 bg-gray-800/50 border-2 border-indigo-700 rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none" placeholder="••••••••">
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-600 hover:to-blue-600 text-white font-bold py-3 px-4 rounded-lg smooth-transition shadow-lg">
                            Masuk
                        </button>
                    </form>
                    <p class="text-center text-sm text-gray-400 mt-6">
                        Belum punya akun? 
                        <button id="show-register-btn" class="font-semibold text-cyan-400 hover:underline">Daftar sekarang</button>
                    </p>
                </div>
            </div>

            <!-- Form Register -->
            <div id="register-view" class="hidden">
                <div class="glass-card p-8 rounded-2xl shadow-2xl">
                    <h2 class="text-3xl font-bold text-center text-cyan-300 mb-6">Buat Akun Baru</h2>
                    <form id="register-form" class="space-y-4">
                        <div>
                            <label for="register-username" class="text-sm font-medium text-indigo-200">Username</label>
                            <input type="text" id="register-username" required class="w-full p-3 mt-1 bg-gray-800/50 border-2 border-indigo-700 rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none" placeholder="Contoh: Imam Keren">
                        </div>
                        <div>
                            <label for="register-phone" class="text-sm font-medium text-indigo-200">No. Telepon</label>
                            <input type="tel" id="register-phone" required class="w-full p-3 mt-1 bg-gray-800/50 border-2 border-indigo-700 rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none" placeholder="08123456789">
                        </div>
                        <div>
                            <label for="register-password" class="text-sm font-medium text-indigo-200">Password</label>
                            <input type="password" id="register-password" required class="w-full p-3 mt-1 bg-gray-800/50 border-2 border-indigo-700 rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none" placeholder="Minimal 6 karakter">
                        </div>
                        <div>
                            <label for="register-pin" class="text-sm font-medium text-indigo-200">PIN Transaksi (6 digit)</label>
                            <input type="password" id="register-pin" required pattern="\d{6}" maxlength="6" class="w-full p-3 mt-1 bg-gray-800/50 border-2 border-indigo-700 rounded-lg focus:ring-2 focus:ring-cyan-400 focus:outline-none" placeholder="••••••">
                        </div>
                        <button type="submit" class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white font-bold py-3 px-4 rounded-lg smooth-transition shadow-lg">
                            Daftar
                        </button>
                    </form>
                    <p class="text-center text-sm text-gray-400 mt-6">
                        Sudah punya akun? 
                        <button id="show-login-btn" class="font-semibold text-cyan-400 hover:underline">Masuk di sini</button>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notification-modal" class="fixed top-8 left-1/2 -translate-x-1/2 z-50 hidden">
        <div id="notification-card" class="p-4 rounded-lg text-white font-semibold shadow-2xl min-w-[250px] text-center">
            <p id="notification-message"></p>
        </div>
    </div>

    <!-- ===== SCRIPT APLIKASI ===== -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // GANTI INI DENGAN KONFIGURASI FIREBASE MILIK ANDA YANG ASLI
        const firebaseConfig = {
          apiKey: "AIzaSyBv31cJC19pEpa6EpamkgaexRdpN0425TKsY",
          authDomain: "imammulmu322.firebaseapp.com",
          projectId: "imammulmu322",
          storageBucket: "imammulmu322.appspot.com",
          messagingSenderId: "1048023716109",
          appId: "1:1048023716109:web:e467f867fdd9104ed518b4"
        };
        
        // --- Inisialisasi Firebase ---
        let db, auth;

        const showNotification = (message, isError = false) => {
            const notifModal = document.getElementById('notification-modal');
            const notifCard = document.getElementById('notification-card');
            const notifMessage = document.getElementById('notification-message');
            notifMessage.innerText = message;
            notifCard.className = `p-4 rounded-lg text-white font-semibold shadow-2xl min-w-[250px] text-center ${isError ? 'bg-red-500' : 'bg-green-500'}`;
            notifModal.style.display = 'flex';
            setTimeout(() => { notifModal.style.display = 'none'; }, 3000);
        };

        // --- Fungsi Autentikasi ---
        const handleRegister = async (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value;
            const phone = document.getElementById('register-phone').value;
            const password = document.getElementById('register-password').value;
            const pin = document.getElementById('register-pin').value;
            
            if (pin.length !== 6) { 
                showNotification("PIN harus 6 digit angka.", true); 
                return; 
            }
            
            const userRef = doc(db, "users", phone);
            const docSnap = await getDoc(userRef);
            
            if (docSnap.exists()) { 
                showNotification("Nomor telepon sudah terdaftar.", true);
            } else {
                await setDoc(userRef, { 
                    username, 
                    password, 
                    pin, 
                    balance: 0, 
                    createdAt: serverTimestamp() 
                });
                showNotification("Pendaftaran berhasil! Silakan login.");
                document.getElementById('show-login-btn').click();
                e.target.reset();
            }
        };

        const handleLogin = async (e) => {
            e.preventDefault();
            const phone = document.getElementById('login-phone').value;
            const password = document.getElementById('login-password').value;
            
            const userRef = doc(db, "users", phone);
            const docSnap = await getDoc(userRef);
            
            if (docSnap.exists()) {
                const userData = docSnap.data();
                if (userData.password === password) {
                    showNotification(`Selamat datang, ${userData.username}!`);
                    // Redirect ke main.html dengan parameter phone
                    setTimeout(() => {
                        window.location.href = `main.html?phone=${phone}`;
                    }, 1500);
                } else { 
                    showNotification("Password salah.", true); 
                }
            } else { 
                showNotification("Nomor telepon tidak ditemukan.", true); 
            }
        };

        // --- Inisialisasi Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                signInAnonymously(auth);
            } catch (e) { 
                console.error("Gagal konek Firebase:", e); 
                alert("Gagal terhubung ke Firebase. Cek konfigurasi."); 
            }

            document.getElementById('show-register-btn').addEventListener('click', () => {
                document.getElementById('login-view').classList.add('hidden');
                document.getElementById('register-view').classList.remove('hidden');
            });

            document.getElementById('show-login-btn').addEventListener('click', () => {
                document.getElementById('login-view').classList.remove('hidden');
                document.getElementById('register-view').classList.add('hidden');
            });

            document.getElementById('register-form').addEventListener('submit', handleRegister);
            document.getElementById('login-form').addEventListener('submit', handleLogin);
        });
    </script>
</body>
</html>